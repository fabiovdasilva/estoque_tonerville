<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>PrintControl - Sistema Unificado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            /* --- Cores Base (Compartilhadas) --- */
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            
            /* --- MODO CLARO (Padrão) --- */
            --bg-body: #f5f7fa;
            --bg-card: #ffffff;
            --bg-sidebar: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
            --text-main: #333333;
            --text-muted: #6c757d;
            --border-color: #eeeeee;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --table-head-bg: #f8f9fa;
            --table-hover: #fafafa;
            --filter-bar-bg: #ffffff; /* Fundo da barra de filtros claro */
        }

        /* --- MODO ESCURO (Tons de Azul Noturno Profundo) --- */
        body.dark-mode {
            /* Fundo Geral */
            --bg-body: #0f1216;      /* Quase preto, muito sutil */
            
            /* Elementos (Cards, Filtros, Modais) */
            --bg-card: #1a222c;      /* Azul petróleo escuro */
            --filter-bar-bg: #1a222c; /* Garante que a barra de filtros use essa cor */
            
            /* Sidebar (Mantida) */
            --bg-sidebar: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
            
            /* Textos */
            --text-main: #e0e6ed;    /* Branco gelo */
            --text-muted: #94a3b8;   /* Cinza azulado */
            
            /* Bordas */
            --border-color: #2d3748;
            
            /* Inputs (Campos de texto) */
            --input-bg: #232d3a;     /* Um pouco mais claro que o card para contraste */
            --input-border: #38465a;
            
            /* Tabelas */
            --table-head-bg: #151b23;
            --table-hover: #263140;
        }

        /* --- APLICAÇÃO GLOBAL --- */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- FORÇA BRUTA: SOBRESCREVENDO CLASSES DAS PÁGINAS --- */
        
        /* 1. Barra de Filtros (Box de Busca em Estoque, Clientes, Vendas) */
        body.dark-mode .filter-bar,
        body.dark-mode .card-header, 
        body.dark-mode .page-header {
            background-color: var(--bg-card) !important;
            border-color: var(--border-color) !important;
            color: var(--text-main) !important;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2) !important; /* Sombra mais forte no dark */
        }

        /* 2. Cards e Containers Brancos */
        body.dark-mode .bg-white, 
        body.dark-mode .bg-light,
        body.dark-mode .card,
        body.dark-mode .modal-content,
        body.dark-mode .list-group-item,
        body.dark-mode .accordion-item,
        body.dark-mode .accordion-body {
            background-color: var(--bg-card) !important;
            color: var(--text-main) !important;
            border-color: var(--border-color) !important;
        }

        /* 3. Inputs (Caixas de Texto, Selects) */
        body.dark-mode .form-control, 
        body.dark-mode .form-select,
        body.dark-mode textarea {
            background-color: var(--input-bg) !important;
            border-color: var(--input-border) !important;
            color: #ffffff !important; /* Texto branco puro dentro do input */
        }
        
        body.dark-mode .form-control:focus, 
        body.dark-mode .form-select:focus {
            background-color: var(--input-bg) !important;
            border-color: var(--secondary-color) !important;
            color: #ffffff !important;
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        /* Placeholder (Texto de ajuda dentro do input) */
        body.dark-mode ::placeholder { color: #6c7a89 !important; opacity: 1; }
        body.dark-mode :-ms-input-placeholder { color: #6c7a89 !important; }

        /* 4. Tabelas */
        body.dark-mode .table {
            color: var(--text-main) !important;
            border-color: var(--border-color);
        }
        body.dark-mode .table thead th {
            background-color: var(--table-head-bg) !important;
            color: var(--text-muted) !important;
            border-color: var(--border-color);
        }
        body.dark-mode .table tbody td {
            background-color: var(--bg-card) !important;
            border-color: var(--border-color);
        }
        body.dark-mode .table-hover tbody tr:hover td {
            background-color: var(--table-hover) !important;
        }
        body.dark-mode .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(255,255,255,0.02) !important;
        }

        /* 5. Textos e Ícones */
        body.dark-mode .text-dark { color: var(--text-main) !important; }
        body.dark-mode .text-muted { color: var(--text-muted) !important; }
        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3, 
        body.dark-mode h4, body.dark-mode h5, body.dark-mode h6 {
            color: var(--text-main) !important;
        }

        /* 6. Botões e Modais */
        body.dark-mode .btn-close { filter: invert(1) grayscale(100%) brightness(200%); }
        body.dark-mode .modal-header, body.dark-mode .modal-footer {
            border-color: var(--border-color);
            background-color: var(--bg-card) !important;
        }

        /* 7. Autocomplete e Menus */
        body.dark-mode .autocomplete-suggestions {
            background-color: var(--bg-card) !important;
            border-color: var(--border-color) !important;
        }
        body.dark-mode .autocomplete-suggestion {
            background-color: var(--bg-card);
            color: var(--text-main);
        }
        body.dark-mode .autocomplete-suggestion:hover {
            background-color: var(--table-hover);
        }

        /* --- LAYOUT GERAL --- */
        .sidebar { 
            background: var(--bg-sidebar); 
            min-height: 100vh; 
            color: white; 
            padding: 0; 
            position: fixed; 
            width: 250px; 
            z-index: 1000; 
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1); 
        }
        .sidebar-brand { padding: 20px; background-color: rgba(0, 0, 0, 0.2); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .sidebar .nav-link { color: rgba(255, 255, 255, 0.8); padding: 12px 20px; transition: all 0.3s; border-left: 4px solid transparent; cursor: pointer; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background-color: rgba(255, 255, 255, 0.1); border-left-color: var(--secondary-color); color: white; }
        
        .main-content { margin-left: 250px; padding: 20px; }
        
        /* Ajuste fino para Cards */
        .card { 
            background-color: var(--bg-card); 
            border-radius: 10px; 
            border: 1px solid var(--border-color); 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); 
            margin-bottom: 24px; 
        }
        
        .page-header { margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: #4a6572; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #34495e; }
    </style>
</head>
<body>
    <div class="sidebar d-flex flex-column">
        <div class="sidebar-brand">
            <h3 class="fw-bold m-0 text-white"><i class="fas fa-print me-2"></i> PrintControl</h3>
        </div>
        <div class="mt-4 flex-grow-1">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" href="{{ url_for('index') }}">
                        <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'estoque' %}active{% endif %}" href="{{ url_for('estoque') }}">
                        <i class="fas fa-boxes me-2"></i> Estoque
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'fornecedores' %}active{% endif %}" href="{{ url_for('fornecedores') }}">
                        <i class="fas fa-truck me-2"></i> Fornecedores
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'clientes' %}active{% endif %}" href="{{ url_for('clientes') }}">
                        <i class="fas fa-users me-2"></i> Clientes
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'vendas' %}active{% endif %}" href="{{ url_for('vendas') }}">
                            <i class="fas fa-shopping-cart me-2"></i> Vendas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'saida_locacao' %}active{% endif %}" href="{{ url_for('saida_locacao') }}">
                        <i class="fas fa-box-open me-2"></i> Saída Locação
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'contratos' %}active{% endif %}" href="{{ url_for('contratos') }}">
                        <i class="fas fa-file-contract me-2"></i> Contratos
                    </a>

                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'impressoras' %}active{% endif %}" href="{{ url_for('impressoras') }}">
                        <i class="fas fa-print me-2"></i> Impressoras
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'notificacoes' %}active{% endif %}" href="{{ url_for('notificacoes') }}">
                        <i class="fas fa-bell me-2"></i> Notificações
                        {% if total_alertas and total_alertas > 0 %}
                            <span class="badge bg-danger ms-2 rounded-pill">{{ total_alertas }}</span>
                        {% endif %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'logs' %}active{% endif %}" href="{{ url_for('logs') }}">
                        <i class="fas fa-list-ul me-2"></i> Logs
                    </a>
                </li>
                <li class="nav-item mt-2">
                    <a class="nav-link {% if request.endpoint == 'configuracoes' %}active{% endif %}" href="{{ url_for('configuracoes') }}">
                        <i class="fas fa-cog me-2"></i> Configurações
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="p-3 border-top border-secondary">
            <a class="nav-link text-white-50" href="#" onclick="toggleDarkMode(event)">
                <i class="fas fa-moon me-2" id="icon-theme"></i> <span id="text-theme">Modo Escuro</span>
            </a>
        </div>
    </div>

    <div class="main-content">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert alert-info alert-dismissible fade show shadow-sm">
                    {% for message in messages %}{{ message }}{% endfor %}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'enabled');
            
            const icon = document.getElementById('icon-theme');
            const text = document.getElementById('text-theme');
            if(icon) { icon.classList.remove('fa-moon'); icon.classList.add('fa-sun'); }
            if(text) { text.innerText = "Modo Claro"; }
        }

        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'disabled');
            
            const icon = document.getElementById('icon-theme');
            const text = document.getElementById('text-theme');
            if(icon) { icon.classList.remove('fa-sun'); icon.classList.add('fa-moon'); }
            if(text) { text.innerText = "Modo Escuro"; }
        }

        function toggleDarkMode(e) {
            e.preventDefault();
            if (document.body.classList.contains('dark-mode')) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            if (localStorage.getItem('darkMode') === 'enabled') {
                enableDarkMode();
            }
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>